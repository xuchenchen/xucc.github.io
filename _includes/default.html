
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <title>徐老师</title>
    <link rel="stylesheet" href="http://cache.amap.com/lbs/static/main1119.css"/>
    <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.4.6&key=08c8e066705a7186bc2c06e197df6260"></script>
    <script type="text/javascript" src="http://cache.amap.com/lbs/static/addToolbar.js"></script>
    
    <title></title>

    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="description" content="">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="">
    <meta name="twitter:description" content="">

    <meta property="og:type" content="article">
    <meta property="og:title" content="">
    <meta property="og:description" content="">

    <link rel="icon" type="image/png" href="/assets/images/favicon.png" />
    <link href="/assets/images/favicon.png" rel="shortcut icon" type="image/png">
    <link href="/apple-touch-icon-precomposed.png" rel="apple-touch-icon">

    <!-- Styles and Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/css/vno.css" />
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/assets/css/tomorrow.css">
    
    <!-- Ghost Head  -->
   

</head>

  
  
<!--添加了百度的统计-->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?a8bed9b1e2886e12b7596655bac7bd67"; //请您改成自己的代码，这是言十年的百度代码哦
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
  
  /***************************************
由于Chrome、IOS10等已不再支持非安全域的浏览器定位请求，为保证定位成功率和精度，请尽快升级您的站点到HTTPS。
***************************************/
    var map, geolocation;
    //加载地图，调用浏览器定位服务
    map = new AMap.Map('container', {
        resizeEnable: true
    });
    map.plugin('AMap.Geolocation', function() {
        geolocation = new AMap.Geolocation({
            enableHighAccuracy: true,//是否使用高精度定位，默认:true
            timeout: 10000,          //超过10秒后停止定位，默认：无穷大
            buttonOffset: new AMap.Pixel(10, 20),//定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)
            zoomToAccuracy: true,      //定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false
            buttonPosition:'RB'
        });
        map.addControl(geolocation);
        geolocation.getCurrentPosition();
        AMap.event.addListener(geolocation, 'complete', onComplete);//返回定位信息
      
    });
    //解析定位结果
    function onComplete(data) {
        var str=[''];
        str.push(data.position.getLng());
        str.push('W' + data.position.getLat());
        if(data.accuracy){
             str.push('=' + data.accuracy + 'm');
        }//如为IP精确定位结果则没有精度信息
      
        document.getElementById('tipsa').innerHTML = str.join('<br>');
    }
   
</script>

<body class="home-template no-js">
<div id='container'></div>

    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
     
    </span>

    <header class="panel-cover " >

  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        
        <a href="http://goileo.top" title="前往 Goileo Lee 的主页"><img src="/assets/images/avatar.jpg" width="90" alt="Goileo Lee logo" class="panel-cover__logo logo" /></a>
        
        <h1 class="panel-cover__title panel-title"><a href="http://goileo.top" title="link to homepage for Goileo Lee">Goileo Lee</a></h1>
        <span class="panel-cover__subtitle panel-subtitle">welcome to goileolee's site</span>
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">深沉的意志，恢宏的想象和炽热的情感</p>
	<p id="tipsa" class="panel-cover__description">深沉的意志，恢宏的想象和炽热的情感</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />

        <div class="navigation-wrapper">
          <div>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="访问博客" class="blog-button">博客</a></li>
              <li class="navigation__item"><a href="/timeline" title="文章目录">目录</a></li>
              <li class="navigation__item"><a href="/aboutme" title="关于GoileoLee">关于</a></li>
            </ul>
          </nav>
          </div>
          <div>
          <nav class="cover-navigation navigation--social">
  <ul class="navigation">


  <!-- Github -->
  <li class="navigation__item">
    <a href="http://github.com/goileolee" title="GoileoLee 的 Github" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>

  <!-- Weibo -->
  <li class="navigation__item">
    <a href="http://weibo.com/goileolee" title="@null" target="_blank">
      <i class='social fa fa-weibo'></i>
      <span class="label">Weibo</span>
    </a>
  </li>

  <!-- Twitter -->
  <li class="navigation__item">
    <a href="http://twitter.com/goileolee" title="@null" target="_blank">
      <i class='social fa fa-twitter'></i>
      <span class="label">Twitter</span>
    </a>
  </li>
  
  <!-- RSS -->
  <li class="navigation__item">
    <a href="http://goileo.top/rss/" rel="author" title="RSS-null" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>

  <!-- Email -->
  <li class="navigation__item">
    <a href="mailto:goileolee@gmail.com" title="goileolee@gmail.com">
      <i class='social fa fa-envelope'></i>
      <span class="label">Email</span>
    </a>
  </li>

  </ul>
</nav>
          </div>
        </div>

      </div>

    </div>

    <div class="panel-cover--overlay cover-blue"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner">
           <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?a8bed9b1e2886e12b7596655bac7bd67";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



  <div class="main-post-list hidden">

    <ol class="post-list">
     
      <li>
        <h2 class="post-list__post-title post-title"><a href="http://goileo.top/%E5%A6%82%E4%BD%95%E5%85%8D%E8%B4%B9%E4%B8%94%E5%BF%AB%E9%80%9F%E7%9A%84%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99" title="link to 如何搭建个人网站">如何搭建个人网站</a></h2>
        <p class="excerpt">
            
    
    
    <h5 id="写在开头">写在开头</h5>


    
    &hellip;</p>
        <div class="post-list__meta"><time datetime="
    November
    26th,
    
    2017" class="post-list__meta--date date">
    November
    26th,
    
    2017</time> &#8226; <span class="post-list__meta--tags tags">于 personalwebsitepersonal website</span><a class="btn-border-small" href="http://goileo.top/%E5%A6%82%E4%BD%95%E5%85%8D%E8%B4%B9%E4%B8%94%E5%BF%AB%E9%80%9F%E7%9A%84%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99"}>继续阅读</a></div>
        <hr class="post-list__divider" />
      </li>
      
      <li>
        <h2 class="post-list__post-title post-title"><a href="http://goileo.top/Android%E4%BB%A3%E7%A0%81%E6%A8%A1%E6%8B%9F%E7%94%9F%E6%88%90%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%94%E5%9B%9EJSON%E6%A0%BC%E5%BC%8F%E6%95%B0%E6%8D%AE" title="link to Android代码模拟生成服务器返回JSON格式数据">Android代码模拟生成服务器返回JSON格式数据</a></h2>
        <p class="excerpt">
             
    
    
    ####S：
在服务器端开发同学还没有写好接口的时候，或服务器端开发同学给出的接口不能让你满意的时候，你就可以通过以下两种方式来自己实现接口。
####T：
这里列举了两种实现方式，分别是Google的Gson解析工具包和Alibaba的FastJson解析工具包。
####A：
<ul>
  <li>方式一：
　　Google的gson.jar中的com.google.gson.Gson.toJson(Object src)
　　在gson的api中，提供了两个重要的方法：toJson()和fromJson()方法。其中，toJson()方法用来实现将<a href="http://lib.csdn.net/base/java">Java</a>对象转换为相应的JSON数据，fromJson()方法则用来实现将JSON数据转换为相应的Java对象。</li>
</ul>

    toJson()方法用于将Java对象转换为相应的JSON数据，主要有以下几种形式：
　　（1）String toJson(JsonElement jsonElement);
　　（2）String toJson(Object src);
　　（3）String toJson(Object src, Type typeOfSrc);
　　其中，
　　方法（1）用于将JsonElement对象（可以是JsonObject、JsonArray等）转换成JSON数据；
　　方法（2）用于将指定的Object对象序列化成相应的JSON数据；
　　方法（3）用于将指定的Object对象（可以包括泛型类型）序列化成相应的JSON数据。

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public String getJsonStr() { 
    List&lt;Person&gt; list = new ArrayList&lt;Person&gt;(); 
    Person mPerson1 = new Person(01, "tom", 22);//id,name,age 
    Person mPerson2 = new Person(02, "rose", 24); 
    Person mPerson3 = new Person(03, "jack", 26); 
    list.add(mPerson1); 
    list.add(mPerson2); 
    list.add(mPerson3); 
    Gson mGson = new Gson(); 
    String jsonStr = mGson.toJson(list); 
    return jsonStr;
}
</code></pre></div></div>

<ul>
  <li>方式二：
　　Alibaba的fastjson.jar中的com.alibaba.fastjson.JSON.toJSONString(Objectobject)
　　Fastjson是一个Java语言编写的高性能功能完善的JSON库。fastjson采用独创的<a href="http://lib.csdn.net/base/datastructure">算法</a>，将parse的速度提升到极致，超过所有json库，包括曾经号称最快的jackson。并且还超越了google的二进制协议protocol buf。Fastjson完全支持<a href="http://json.org/">http://json.org</a>的标准，也是官方网站收录的参考实现之一。支持各种JDK类型。包括基本类型、JavaBean、Collection、Map、Enum、泛型等。支持JDK 5、JDK 6、<a href="http://lib.csdn.net/base/android">Android</a>、阿里云手机等环境。
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Map&lt;String, Object&gt; maps = new HashMap&lt;String, Object&gt;();
List&lt;Map&lt;String, Object&gt;&gt; arrayList = new ArrayList&lt;Map&lt;String, Object&gt;&gt;();　　
Map&lt;String ,Object&gt; params1 = new HashMap&lt;String, Object&gt;();　
Map&lt;String ,Object&gt; params2 = new HashMap&lt;String, Object&gt;();　
params1.put("id", 01);　　
params1.put("name", "tom");　　
params1.put("url", "http://www.baidu.com");　　
params2.put("id", 02);　　
params2.put("name", "jack");　　
params2.put("url", "http://www.google.com");　　
arrayList.add(params1);　　
arrayList.add(params2);　　
maps.put("desc", "json");　　
maps.put("age", "29");　　
maps.put("users", arrayList);　　
String jsonStr = JSON.toJSONString(maps);
</code></pre></div>    </div>
    ####R：
这里偷个懒，就不图了，使用Log打印一下jsonStr就可以看到json格式的数据了。。
  </li>
</ul>

　　　　ok!两种实现方式如上，仅供学习。

    
    &hellip;</p>
        <div class="post-list__meta"><time datetime="
    August
    15th,
    
    2017" class="post-list__meta--date date">
    August
    15th,
    
    2017</time> &#8226; <span class="post-list__meta--tags tags">于 Android</span><a class="btn-border-small" href="http://goileo.top/Android%E4%BB%A3%E7%A0%81%E6%A8%A1%E6%8B%9F%E7%94%9F%E6%88%90%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%94%E5%9B%9EJSON%E6%A0%BC%E5%BC%8F%E6%95%B0%E6%8D%AE"}>继续阅读</a></div>
        <hr class="post-list__divider" />
      </li>
      
      <li>
        <h2 class="post-list__post-title post-title"><a href="http://goileo.top/%E4%BD%BF%E7%94%A8EditText%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" title="link to 使用EditText遇到的问题及解决方案">使用EditText遇到的问题及解决方案</a></h2>
        <p class="excerpt">
             
    
    
    ####S：

在开发中，产品给的要求是，在填写地址的输入框内只能有两行内容，输入框在横屏的Dialog上，软键盘半屏显示且点击软键盘的右下角按钮实现actionDone功能。

####T：

上面的场景可能有点复杂，先一个个问题来解决。
<ul>
  <li>dialog横屏下，软键盘半屏显示。</li>
  <li>软键盘右下角按钮为完成，即点击关闭软键盘，而不是换行。</li>
  <li>只显示两行内容。</li>
</ul>

####A：

<ol>
  <li>dialog横屏下，软键盘半屏显示。
imeOptions=”flagNoExtractUi”
设置前</li>
</ol>

<img src="http://upload-images.jianshu.io/upload_images/4105122-752e5bd084e89556.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="设置前" />

设置后

<img src="http://upload-images.jianshu.io/upload_images/4105122-91954d7a3ea14eb5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="设置后" />

<ol>
  <li>软键盘右下角按钮为完成，即点击关闭软键盘，而不是换行。
imeOptions=”actionDone|flagNoExtractUi”
inputType=”text”</li>
  <li>只显示两行内容。
xml中
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>android:inputType=”text|textCapSentences”
</code></pre></div>    </div>
    java中
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mEditText.setHorizontallyScrolling(false);
mEditText.setMaxLines(2);
</code></pre></div>    </div>
  </li>
</ol>

####R：

三个步骤实现不同的功能需求。
另外在SDK 23及以后，singleLine过时，以下代码能实现其相同功能。
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>android:maxLines=“1”
android:inputType="text"
</code></pre></div></div>
如有不理解或是写的不对的地方，欢迎留言指出。
如果能帮你解决困难，是我的荣幸！同时也作备忘。

感谢！

    
    &hellip;</p>
        <div class="post-list__meta"><time datetime="
    August
    14th,
    
    2017" class="post-list__meta--date date">
    August
    14th,
    
    2017</time> &#8226; <span class="post-list__meta--tags tags">于 Android</span><a class="btn-border-small" href="http://goileo.top/%E4%BD%BF%E7%94%A8EditText%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"}>继续阅读</a></div>
        <hr class="post-list__divider" />
      </li>
      
      <li>
        <h2 class="post-list__post-title post-title"><a href="http://goileo.top/S-T-A-R-%E6%B3%95%E5%88%99" title="link to S-T-A-R-法则">S-T-A-R-法则</a></h2>
        <p class="excerpt">
            
    
    
    <ul>
  <li>
    STAR法则是情境(situation)、任务(task)、行动(action)、结果(result)四项的缩写。STAR法则是一种常常被面试官使用的工具，用来收集面试者与工作相关的具体信息和能力。
  </li>
  <li>
    具体含义是:
  </li>
</ul>

<blockquote>
  Situation: 事情是在什么情况下发生<br />
Task: 你是如何明确你的任务的<br />
Action: 针对这样的情况分析，你采用了什么行动方式<br />
Result: 结果怎样，在这样的情况下你学习到了什么
</blockquote>

<ul>
  <li>现在主要运用在面试者的简历中。不过笔者认为STAR法则可以应用到记录、叙述文的书写中，所以以后笔者的一些记录、叙述类型的文章中会直接通过STAR的形式来架构和书写。</li>
</ul>

比如：<a href="http://www.jianshu.com/p/7e365542924f">使用EditText遇到的问题及解决方案</a>

    
    &hellip;</p>
        <div class="post-list__meta"><time datetime="
    August
    13th,
    
    2017" class="post-list__meta--date date">
    August
    13th,
    
    2017</time> &#8226; <span class="post-list__meta--tags tags">于 Android</span><a class="btn-border-small" href="http://goileo.top/S-T-A-R-%E6%B3%95%E5%88%99"}>继续阅读</a></div>
        <hr class="post-list__divider" />
      </li>
      
      <li>
        <h2 class="post-list__post-title post-title"><a href="http://goileo.top/Android%E5%BC%80%E5%8F%91%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7Fiddler%E6%9B%B4%E6%94%B9%E5%90%8E%E5%8F%B0%E6%8E%A5%E5%8F%A3%E6%95%B0%E6%8D%AE" title="link to Android开发中用Fiddler抓包，更改后台接口数据">Android开发中用Fiddler抓包，更改后台接口数据</a></h2>
        <p class="excerpt">
           
    
    
    <img src="http://upload-images.jianshu.io/upload_images/4105122-6b5f220bfe7bae0d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/320" alt="1434282bz51izk5yf45y85.jpg" />

<h4 id="1什么是fiddler">1.什么是Fiddler</h4>

<ul>
  <li><strong>Fiddler</strong>是一个使用 C# 编写的 <strong>http 抓包工具</strong>。它使用灵活，功能强大，支持众多的 http 调试任务，是 web、移动应用的开发调试利器。</li>
  <li>同 <strong>Httpwatch</strong>、<strong>Firebug</strong> 这些抓包工具一样，Fiddler 够记录客户端和服务器之间的所有 http 请求，可以针对特定的 http 请求，分析请求数据、设置断点等。</li>
  <li>但 Fiddler 更为强大的是，它还可以修改请求的数据，甚至可以实现请求自动重定向，从而修改服务器返回的数据。</li>
  <li><strong>Fiddler</strong> 使用也十分方便。在打开 <strong>Fiddler</strong> 的时候，它就自动设置好了浏览器的代理，通过改写 http 代理，让数据从它那通过，来监控并且截取到数据。当关闭 <strong>Fiddler</strong> 的时候，它又自动帮你把代理还原。</li>
  <li>下载地址：<a href="https://www.telerik.com/download/fiddler">https://www.telerik.com/download/fiddler</a></li>
</ul>

<h4 id="2走进fiddler">2.走进Fiddler</h4>

<img src="http://upload-images.jianshu.io/upload_images/4105122-8cdcefe462e34be9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Fiddler主界面说明" />

<ul>
  <li>前面介绍了Fiddler是web、移动应用的开发调试利器。所以，打开Fiddler请求网页，左边的接口列表区域就会显示你所请求的每个接口。</li>
  <li>点击左侧列表中的某个请求，在右侧的Inspectors功能菜单下就可以看到该接口非常详细的请求、返回数据。</li>
</ul>

<img src="http://upload-images.jianshu.io/upload_images/4105122-a4e4ea97eaa496a4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Fiters介绍" />

<ul>
  <li>如果只想要看到自己app请求的接口信息，则可以使用Fiters进行过滤。
Zone：指定只显示内网（Intranet）或互联网（Internet）的内容
Host：指定显示某个域名下的会话
这里以jianshu.com为例。</li>
</ul>

<img src="http://upload-images.jianshu.io/upload_images/4105122-61e4889964ac3e11.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="过滤器" />

<ul>
  <li>如果想修改服务器返回的接口数据，则可以使用AutoResponder功能。</li>
</ul>

<h4 id="3改变接口返回的数据">3.改变接口返回的数据*</h4>

<ul>
  <li>AutoResponder 允许你拦截指定规则的请求，并返回本地资源或 Fiddler 资源，从而代替服务器响应。通常我们在开发App项目的初期，如果出现App端前期工作已经做完了，但服务器端接口联调通过但数据不够完善。这时我们就可以通过Fiddler来修改服务器返回的接口数据了。当然Fiddler还有很多用处，比如某个App在某种情况下限制你进入，那么可以尝试用Fiddler修改接口数据。</li>
  <li>配置</li>
</ul>

<img src="http://upload-images.jianshu.io/upload_images/4105122-c9f5bee3ad6b52cc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Tools-Options" />

<img src="http://upload-images.jianshu.io/upload_images/4105122-8e17e9076eed6ef7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="允许远程连接" />

这里默认端口号是8888，重启Fiddler。然后要求手机和电脑连接到同一网络，Windows系统可以通过cmd-ipconfig查看到ip地址。假设电脑的IP是192.168.1.1，将手机中wifi设置为如下图所示

<img src="http://upload-images.jianshu.io/upload_images/4105122-c0775c03b730c159.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="代理-手动" />

接着打开手机浏览器请求http://192.168.1.1:8888，在打开的页面中点击“FiddlerRoot certificate”。

<img src="http://upload-images.jianshu.io/upload_images/4105122-0ab44eaa6e2d5c56.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="下载安装证书" />

然后在AutoResponder 项中勾选以下两个。第一个复选框的作用是开启或禁用自动重定向功能。
第二个复选框的作用是不理会那些没满足我们处理条件的请求。

<img src="http://upload-images.jianshu.io/upload_images/4105122-6fcf8754b72dce35.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="勾选项" />

配置完成，现在开始对接口的数据进行修改替换。从左边选择一个你想要修改返回数据的接口，点击Add Rule就会自动显示在右边区域，直接按住左边不放拖过来也行。

<img src="http://upload-images.jianshu.io/upload_images/4105122-8e758f2f30416f14.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Add Rule" />

<ul>
  <li>接着添加一个你希望返回的json数据文件，用于替换掉服务器接口返回的数据。用Notepad++创建一个uesrinfo.txt文件作为接口返回数据。</li>
</ul>

<img src="http://upload-images.jianshu.io/upload_images/4105122-d8e4bfe776baa96b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="userinfo" />

点击Find a file，选中userinfo.txt。到此，大功告成！

<img src="http://upload-images.jianshu.io/upload_images/4105122-7a4a34ae82ffc1c2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Find a file" />

<ul>
  <li>最后，打开App，请求接口，看下Android Studio中返回的数据是否发生了改变。</li>
</ul>

<img src="http://upload-images.jianshu.io/upload_images/4105122-b09aec05412a4fe8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="response" />

欢迎加入Android交流群155495090

感谢！

文中部分内容来自：<a href="http://www.hangge.com/blog/cache/detail_1697.html">http://www.hangge.com/blog/cache/detail_1697.html</a>

    
    &hellip;</p>
        <div class="post-list__meta"><time datetime="
    August
    12th,
    
    2017" class="post-list__meta--date date">
    August
    12th,
    
    2017</time> &#8226; <span class="post-list__meta--tags tags">于 Android</span><a class="btn-border-small" href="http://goileo.top/Android%E5%BC%80%E5%8F%91%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7Fiddler%E6%9B%B4%E6%94%B9%E5%90%8E%E5%8F%B0%E6%8E%A5%E5%8F%A3%E6%95%B0%E6%8D%AE"}>继续阅读</a></div>
        <hr class="post-list__divider" />
      </li>
      
      <li>
        <h2 class="post-list__post-title post-title"><a href="http://goileo.top/GreenDAO%E4%BD%BF%E7%94%A8%E5%8F%8A%E5%8D%87%E7%BA%A7" title="link to GreenDAO使用及升级">GreenDAO使用及升级</a></h2>
        <p class="excerpt">
             
    
    
    <img src="http://upload-images.jianshu.io/upload_images/4105122-0f18cd37f08d8e8f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/320" alt="143506vrdrr0ooxwkxxrr0.jpg" />

GreenDAO 3.2.0：
1、在工程的build.gradle中做如下配置：
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>buildscript {
    dependencies {
        classpath 'org.greenrobot:greendao-gradle-plugin:3.0.0'
    }
}
</code></pre></div></div>
2、在app的build.gradle中做如下配置
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apply plugin: 'org.greenrobot.greendao'

android {
      greendao{
        schemaVersion 1 // 当前数据库版本号，升级数据库则+1。
        daoPackage 'com.example.greendao.gen' // 生成数据库文件的具体包
        targetGenDir 'src/main/java' // 生成数据库文件的目录
    }
}

dependencies {
    compile 'org.greenrobot:greendao:3.2.0' // GreenDao在github上的依赖地址
}
</code></pre></div></div>
3、创建Model类，然后，Build - Make Module ‘app’
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Entity(nameInDb = "userinfo")
public class UserInfo implements Serializable {

    @Id(autoincrement = true)
    private Long _id;

    @Property(nameInDb = "username")
    private String username;

    @Property(nameInDb = "age")
    private int age;
    ......
}
</code></pre></div></div>
4、GreenDAO的使用
    ok，上面的是准备工作，接下来才是使用，即得到数据库对象进行增、删、改、查。然后根据自己的代码习惯，做封装。具体实现这里不做叙述，如果有问题欢迎留言。
推荐一篇介绍得很详细的文章，<a href="http://www.jianshu.com/p/4986100eff90">链接地址</a>。

5、GreenDAO升级
    这个也是我写这篇文章的原因，在完成上面的1-4步后，数据库增删改查都没有问题，愉快地commit and push，愉快地拿着工资吃着火锅唱着歌。
    直到某一天，你在你的Model类即userinfo中加入“test”字段，你很愉快地加上了字段，在build中使greendao - schemaVersion +1，并运行……
<img src="http://upload-images.jianshu.io/upload_images/4105122-ea577fbf2c116259.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="表中没有test字段" />

由于你加了新的字段，表发生了变化，做数据库操作时抛出异常，找不到test字段。那么应该以怎么样的姿势新增字段和升级数据库呢？
然后各种查资料搜索，找到了以下代码，完美解决数据库升级问题。其原理也是创建临时数据库来做数据迁移。
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import android.database.Cursor;
import android.text.TextUtils;
import android.util.Log;
import org.greenrobot.greendao.AbstractDao;
import org.greenrobot.greendao.database.Database;
import org.greenrobot.greendao.internal.DaoConfig;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

public class MigrationHelper {

    private static final String CONVERSION_CLASS_NOT_FOUND_EXCEPTION = "MIGRATION HELPER - CLASS DOESN'T MATCH WITH THE CURRENT PARAMETERS";
    private static MigrationHelper instance;

    public static MigrationHelper getInstance() {
        if (instance == null) {
            instance = new MigrationHelper();
        }
        return instance;
    }

    public void migrate(Database db, Class&lt;? extends AbstractDao&lt;?, ?&gt;&gt;... daoClasses) {

        generateTempTables(db, daoClasses);
        DaoMaster.dropAllTables(db, true);
        DaoMaster.createAllTables(db, false);
        restoreData(db, daoClasses);
    }

    /**
     * 生成临时列表
     * @param db
     * @param daoClasses
     */
    private void generateTempTables(Database db, Class&lt;? extends AbstractDao&lt;?, ?&gt;&gt;... daoClasses) {
        for (int i = 0; i &lt; daoClasses.length; i++) {
            DaoConfig daoConfig = new DaoConfig(db, daoClasses[i]);

            String divider = "";
            String tableName = daoConfig.tablename;
            String tempTableName = daoConfig.tablename.concat("_TEMP");
            ArrayList&lt;String&gt; properties = new ArrayList&lt;&gt;();

            StringBuilder createTableStringBuilder = new StringBuilder();

            createTableStringBuilder.append("CREATE TABLE ").append(tempTableName).append(" (");

            for (int j = 0; j &lt; daoConfig.properties.length; j++) {
                String columnName = daoConfig.properties[j].columnName;

                if (getColumns(db, tableName).contains(columnName)) {
                    properties.add(columnName);

                    String type = null;

                    try {
                        type = getTypeByClass(daoConfig.properties[j].type);
                    } catch (Exception exception) {
                        exception.printStackTrace();
                    }

                    createTableStringBuilder.append(divider).append(columnName).append(" ").append(type);

                    if (daoConfig.properties[j].primaryKey) {
                        createTableStringBuilder.append(" PRIMARY KEY");
                    }

                    divider = ",";
                }
            }
            createTableStringBuilder.append(");");

            db.execSQL(createTableStringBuilder.toString());

            StringBuilder insertTableStringBuilder = new StringBuilder();

            insertTableStringBuilder.append("INSERT INTO ").append(tempTableName).append(" (");
            insertTableStringBuilder.append(TextUtils.join(",", properties));
            insertTableStringBuilder.append(") SELECT ");
            insertTableStringBuilder.append(TextUtils.join(",", properties));
            insertTableStringBuilder.append(" FROM ").append(tableName).append(";");

            db.execSQL(insertTableStringBuilder.toString());

        }
    }

    /**
     * 存储新的数据库表 以及数据
     * @param db
     * @param daoClasses
     */
    private void restoreData(Database db, Class&lt;? extends AbstractDao&lt;?, ?&gt;&gt;... daoClasses) {
        for (int i = 0; i &lt; daoClasses.length; i++) {
            DaoConfig daoConfig = new DaoConfig(db, daoClasses[i]);
            String tableName = daoConfig.tablename;
            String tempTableName = daoConfig.tablename.concat("_TEMP");
            ArrayList&lt;String&gt; properties = new ArrayList();

            for (int j = 0; j &lt; daoConfig.properties.length; j++) {
                String columnName = daoConfig.properties[j].columnName;

                if (getColumns(db, tempTableName).contains(columnName)) {
                    properties.add(columnName);
                }
            }

            StringBuilder insertTableStringBuilder = new StringBuilder();

            insertTableStringBuilder.append("INSERT INTO ").append(tableName).append(" (");
            insertTableStringBuilder.append(TextUtils.join(",", properties));
            insertTableStringBuilder.append(") SELECT ");
            insertTableStringBuilder.append(TextUtils.join(",", properties));
            insertTableStringBuilder.append(" FROM ").append(tempTableName).append(";");

            StringBuilder dropTableStringBuilder = new StringBuilder();
            dropTableStringBuilder.append("DROP TABLE ").append(tempTableName);
            db.execSQL(insertTableStringBuilder.toString());
            db.execSQL(dropTableStringBuilder.toString());
        }
    }

    private String getTypeByClass(Class&lt;?&gt; type) throws Exception {
        if (type.equals(String.class)) {
            return "TEXT";
        }
        if (type.equals(Long.class) || type.equals(Integer.class) || type.equals(long.class)) {
            return "INTEGER";
        }
        if (type.equals(Boolean.class)) {
            return "BOOLEAN";
        }

        Exception exception = new Exception(CONVERSION_CLASS_NOT_FOUND_EXCEPTION.concat(" - Class: ").concat(type.toString()));
        exception.printStackTrace();
        throw exception;
    }

    private List&lt;String&gt; getColumns(Database db, String tableName) {
        List&lt;String&gt; columns = new ArrayList&lt;&gt;();
        Cursor cursor = null;
        try {
            cursor = db.rawQuery("SELECT * FROM " + tableName + " limit 1", null);
            if (cursor != null) {
                columns = new ArrayList&lt;&gt;(Arrays.asList(cursor.getColumnNames()));
            }
        } catch (Exception e) {
            Log.v(tableName, e.getMessage(), e);
            e.printStackTrace();
        } finally {
            if (cursor != null)
                cursor.close();
        }
        return columns;
    }
}
</code></pre></div></div>
然后只需要继承DaoMaster.OpenHelper重写onUpgrade方法
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public class SQLiteOpenHelper extends DaoMaster.OpenHelper {

    public SQLiteOpenHelper(Context context, String name, SQLiteDatabase.CursorFactory factory) {
        super(context, name, factory);
    }

    @Override
    public void onUpgrade(Database db, int oldVersion, int newVersion) {
        MigrationHelper.getInstance().migrate(db, UserInfoDao.class);

    }
}
</code></pre></div></div>
最后在初始化DaoMaster处调用。

    
    &hellip;</p>
        <div class="post-list__meta"><time datetime="
    July
    19th,
    
    2017" class="post-list__meta--date date">
    July
    19th,
    
    2017</time> &#8226; <span class="post-list__meta--tags tags">于 Android</span><a class="btn-border-small" href="http://goileo.top/GreenDAO%E4%BD%BF%E7%94%A8%E5%8F%8A%E5%8D%87%E7%BA%A7"}>继续阅读</a></div>
        <hr class="post-list__divider" />
      </li>
      
    </ol>

    <hr class="post-list__divider " />

<nav class="pagination" role="navigation">
    
    <span class="pagination__page-number">1 /  1</span>
    
</nav>

  </div>
 

            
<footer class="footer">
    <span class="footer__copyright">&copy;   All rights reserved.</span>
    <span class="footer__copyright">本主题<a href="https://github.com/goileolee/goileolee.github.io">goileolee/Vno-jekyll</a>改自<a href="https://github.com/yanshinian">yanshinian/Vno-jekyll</a>
	
</footer>
        </div>
    </div>

    <!-- Ghost Footer  -->


    <!--  The main JavaScript file -->
    <script type="text/javascript" src="/assets/js/jquery.js"></script>
    <script type="text/javascript" src="/assets/js/main.js"></script>
 <!-- Highlight.js /assets/js/ --> 
    <script type="text/javascript" src="/assets/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

</body>
</html>
